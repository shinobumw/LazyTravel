CREATE DATABASE IF NOT EXISTS LazyTravel;
USE LazyTravel;

SET FOREIGN_KEY_CHECKS=0;

DROP TABLE IF EXISTS USERS;
DROP TABLE IF EXISTS ROLES;
DROP TABLE IF EXISTS FUNC;
DROP TABLE IF EXISTS ROLE_FUNC;
DROP TABLE IF EXISTS CUSTOMER;
DROP TABLE IF EXISTS CS_MAIL;
DROP TABLE IF EXISTS CS_MESSAGE;
DROP TABLE IF EXISTS CS_IMG;
DROP TABLE IF EXISTS FOODSCAPE;
DROP TABLE IF EXISTS OPENTIME;
DROP TABLE IF EXISTS FOODSCAPE_IMG;
DROP TABLE IF EXISTS TAG;
DROP TABLE IF EXISTS FOODSCAPE_TAG;
DROP TABLE IF EXISTS JOURNEY;
DROP TABLE IF EXISTS JOURNEY_DETAIL;
DROP TABLE IF EXISTS JOURNEY_TIME_FOODSCAPE;
DROP TABLE IF EXISTS TOUR_GROUP;
DROP TABLE IF EXISTS COUPON;
DROP TABLE IF EXISTS CUSTOMER_COUPON;
DROP TABLE IF EXISTS ORDERS; 
DROP TABLE IF EXISTS PASSENGER;
DROP TABLE IF EXISTS BLOG;
DROP TABLE IF EXISTS FOODSCAPE_BLOG;
DROP TABLE IF EXISTS BLOG_MSG;
DROP TABLE IF EXISTS BLOG_IMG;
DROP TABLE IF EXISTS BLOG_LIKE;
DROP TABLE IF EXISTS BLOG_CL;
DROP TABLE IF EXISTS BLOG_TAG;


-- 會員 --
CREATE TABLE CUSTOMER(
	CUSTOMER_ID INT AUTO_INCREMENT,
    CUSTOMER_NAME VARCHAR(20) NOT NULL,
    NICKNAME VARCHAR(30) NOT NULL,
    SEX CHAR(1) NOT NULL,
    PHONE CHAR(10) NOT NULL,
    BIRTH DATE NOT NULL,
    ADDRESS VARCHAR(50) NOT NULL,
    EMAIL VARCHAR(50) NOT NULL UNIQUE,
    CUSTOMER_PASSWD VARCHAR(60) NOT NULL,
    CUSTOMER_STATUS CHAR(1) NOT NULL DEFAULT '1',
	IDNO CHAR(10) NOT NULL,
    AVATAR LONGBLOB,
    CUSTOMER_POINT INT NOT NULL DEFAULT 0,
    CREATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP,
    UPDATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (CUSTOMER_ID)
) AUTO_INCREMENT=11001;

INSERT INTO CUSTOMER (CUSTOMER_NAME, NICKNAME, SEX, PHONE, BIRTH, ADDRESS, EMAIL, CUSTOMER_PASSWD, IDNO) 
    VALUES ('王小明', '小明', 0, '0913798893', '1990-01-01', '台北市中正區重慶南路一段122號', 'wang19000101@gmail.com', '$2b$10$R7npZfTD9vlUIQDns6NR2eOPwPGI1yZowYrOjuAMOSb3.lwiiolqi', 'A123456789');
INSERT INTO CUSTOMER (CUSTOMER_NAME, NICKNAME, SEX, PHONE, BIRTH, ADDRESS, EMAIL, CUSTOMER_PASSWD, IDNO) 
    VALUES ('李志豪', '阿豪', 0, '0975886190', '1989-05-11', '台中市梧棲區臺灣大道十段168號', 'haoge9487@gmail.com', '$2b$10$9.cdcyWHle3GqlBs3mLe7e/Bi3geOQ3PTvyKMq4JrZ8flA/jywsKy', 'K948710591');
INSERT INTO CUSTOMER (CUSTOMER_NAME, NICKNAME, SEX, PHONE, BIRTH, ADDRESS, EMAIL, CUSTOMER_PASSWD, IDNO)
    VALUES ('黃品誼', 'EE', 1, '0971753321', '1996-12-25', '台南市東區大學路1號', 'yeeeeeeee11111@gmail.com', '$2b$10$IKnxYhhamnaLnVamiCEWUuv1g1gLynhdv4YWZGpE.m21ucnjVk5GK', 'K246456997');
INSERT INTO CUSTOMER (CUSTOMER_NAME, NICKNAME, SEX, PHONE, BIRTH, ADDRESS, EMAIL, CUSTOMER_PASSWD, IDNO)
    VALUES ('李淑芬', '芬姐', 1, '0910096323', '1968-09-03', '桃園市桃園區南平路303號', 'fannylee168@gmail.com', '$2b$10$8XbdpentIcewMzZCGch.qe3dCHOvATNp2fLtWl2RpTcLphToY/7dm', 'H223066223');
INSERT INTO CUSTOMER (CUSTOMER_NAME, NICKNAME, SEX, PHONE, BIRTH, ADDRESS, EMAIL, CUSTOMER_PASSWD, IDNO)
    VALUES ('白居易', '白白', 0, '0988878987', '1976-02-26', '臺北市中正區中山南路21號', 'whitecat@gmail.com', '$2b$10$0yhvRzv4C6q6MhdJiePc.uZiPBJmeArymper3nP2BNKSIGOOriPsi', 'A123456987');
INSERT INTO CUSTOMER (CUSTOMER_NAME, NICKNAME, SEX, PHONE, BIRTH, ADDRESS, EMAIL, CUSTOMER_PASSWD, IDNO)
    VALUES ('柯阿文', '柯P', 0, '0907788191', '2022-11-18', '新竹縣竹北市六家六街1巷3號2樓', 'doctorkowj@gmail.com', '$2b$10$gGOcpXpbv9X199OTJc5AuePJ3KkuQoOvd8BosjfYRcUh9aYbsJNpG', 'Q123456987');


-- 客服訊息 --
CREATE TABLE CS_MAIL (
	MAIL_ID	INT NOT NULL AUTO_INCREMENT,
	CUSTOMER_ID	  INT NOT NULL,
    CREATE_TIME DATETIME  DEFAULT CURRENT_TIMESTAMP,
    CS_MAIL_STATUS CHAR(1)  NOT NULL DEFAULT '0',
    questions LONGTEXT,
    answer LONGTEXT,
    RECEIVED_TIME DATETIME  DEFAULT CURRENT_TIMESTAMP,
    
	PRIMARY KEY (MAIL_ID),
	FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER (CUSTOMER_ID)
) AUTO_INCREMENT = 51001;

INSERT INTO CS_MAIL (CUSTOMER_ID, CS_MAIL_STATUS,questions,answer) VALUES ('11001','1', '想修改行程時間','請問想改什麼時間呢?');
INSERT INTO CS_MAIL (CUSTOMER_ID, CS_MAIL_STATUS,questions,answer) VALUES ('11001','1', '請問可以帶毛小孩同行嗎','可以的唷');
INSERT INTO CS_MAIL (CUSTOMER_ID, CS_MAIL_STATUS,questions,answer) VALUES ('11001','0', '請問帶毛小孩需要額外加費用嗎?','');

-- 客服訊息內文 --
CREATE TABLE CS_MESSAGE (
	MESSAGE_ID	INT NOT NULL AUTO_INCREMENT,
	MAIL_ID	  INT NOT NULL,
	CONTENT		LONGTEXT,
    CREATE_TIME DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    MESSAGE_FROM CHAR(1) NOT NULL,

	PRIMARY KEY (MESSAGE_ID),
	FOREIGN KEY (MAIL_ID) REFERENCES CS_MAIL (MAIL_ID)
) AUTO_INCREMENT = 1;

INSERT INTO CS_MESSAGE (MAIL_ID, CONTENT, MESSAGE_FROM) VALUES (51001, '請問連假有加開行程嗎？', '0');
INSERT INTO CS_MESSAGE (MAIL_ID, CONTENT, MESSAGE_FROM) VALUES (51001, '我想取消這筆訂單，訂單編號是XXX', '0');
INSERT INTO CS_MESSAGE (MAIL_ID, CONTENT, MESSAGE_FROM) VALUES (51002, '優惠券沒有使用成功，訂單編號是XXX', '0');

-- 客服訊息圖片 --
CREATE TABLE CS_IMG(
	IMG_ID   INT AUTO_INCREMENT NOT NULL,
	MESSAGE_ID   INT NOT NULL,
	IMG   LONGBLOB,
	CREATE_TIME DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    PRIMARY KEY (IMG_ID),
	FOREIGN KEY (MESSAGE_ID) REFERENCES CS_MESSAGE (MESSAGE_ID)
) AUTO_INCREMENT = 1;

INSERT INTO CS_IMG (MESSAGE_ID) VALUES (1), (1), (2);

-- 後臺角色 --
CREATE TABLE ROLES(
	ROLE_ID INT AUTO_INCREMENT,
    ROLE_NAME VARCHAR(20) NOT NULL UNIQUE,
    ROLE_DESCR VARCHAR(100),
    
    PRIMARY KEY (ROLE_ID)
) AUTO_INCREMENT = 1;

INSERT INTO ROLES (ROLE_NAME, ROLE_DESCR) VALUES ('管理員', 'superuser擁有所有權限');
INSERT INTO ROLES (ROLE_NAME, ROLE_DESCR) VALUES ('客服', '客服可查看訂單、客服系統');
INSERT INTO ROLES (ROLE_NAME, ROLE_DESCR) VALUES ('測試', '測試test');

-- 後臺功能 --
CREATE TABLE FUNC(
	FUNC_ID INT AUTO_INCREMENT,
    FUNC_NAME VARCHAR(20) NOT NULL UNIQUE,
    FUNC_DESCR VARCHAR(100),
    
    PRIMARY KEY (FUNC_ID)
) AUTO_INCREMENT = 1;

INSERT INTO FUNC (FUNC_NAME, FUNC_DESCR) VALUES ('後臺首頁', '後臺首頁');
INSERT INTO FUNC (FUNC_NAME, FUNC_DESCR) VALUES ('客服系統', '客服訊息查看與回覆');

-- 後臺使用者權限 (關係) --
CREATE TABLE ROLE_FUNC(
	ROLE_ID INT,
	FUNC_ID INT,
    CREATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    PRIMARY KEY (ROLE_ID, FUNC_ID),
    FOREIGN KEY (ROLE_ID) REFERENCES ROLES(ROLE_ID) ON DELETE CASCADE,
    FOREIGN KEY (FUNC_ID) REFERENCES FUNC(FUNC_ID) ON DELETE CASCADE
);

INSERT INTO ROLE_FUNC (ROLE_ID, FUNC_ID) VALUES (1, 1);
INSERT INTO ROLE_FUNC (ROLE_ID, FUNC_ID) VALUES (1, 2);
INSERT INTO ROLE_FUNC (ROLE_ID, FUNC_ID) VALUES (2, 2);

-- 後臺使用者 --
CREATE TABLE USERS(
	USER_ID INT AUTO_INCREMENT,
    USERNAME VARCHAR(30) NOT NULL UNIQUE,
    USER_PASSWD VARCHAR(60) NOT NULL,
    ROLE_ID INT,
    USER_STATUS CHAR(1) NOT NULL DEFAULT '1',
    CREATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP,
    UPDATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    PRIMARY KEY (USER_ID),
    FOREIGN KEY (ROLE_ID) REFERENCES roles(ROLE_ID) ON DELETE SET NULL
) AUTO_INCREMENT = 12001;

INSERT INTO USERS (USERNAME, USER_PASSWD, ROLE_ID) VALUES ('admin', '$2b$10$R7npZfTD9vlUIQDns6NR2eOPwPGI1yZowYrOjuAMOSb3.lwiiolqi', 1);
INSERT INTO USERS (USERNAME, USER_PASSWD, ROLE_ID) VALUES ('cs123', '$2b$10$R7npZfTD9vlUIQDns6NR2eOPwPGI1yZowYrOjuAMOSb3.lwiiolqi', 2);
INSERT INTO USERS (USERNAME, USER_PASSWD, ROLE_ID) VALUES ('test123', '$2b$10$R7npZfTD9vlUIQDns6NR2eOPwPGI1yZowYrOjuAMOSb3.lwiiolqi', 3);

-- 美食景點 --
CREATE TABLE FOODSCAPE (
	FOODSCAPE_ID INT AUTO_INCREMENT NOT NULL,
	FOODSCAPE_NAME VARCHAR(50) NOT NULL UNIQUE,
	PHONE CHAR(10) NOT NULL,
	ADDRESS VARCHAR(50) NOT NULL,
	CITY VARCHAR(6) NOT NULL,
	LNG DOUBLE(11,8) NOT NULL,
	LAT DOUBLE(10,8) NOT NULL,
	INTRO LONGTEXT,
	UPDATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	FOODSCAPE_STATUS CHAR(1) NOT NULL,
	CATEGORY VARCHAR(4) NOT NULL,
    
    PRIMARY KEY (FOODSCAPE_ID)
) AUTO_INCREMENT = 22001;


 INSERT INTO FOODSCAPE (FOODSCAPE_NAME, PHONE, ADDRESS, CITY, LNG, LAT, INTRO, FOODSCAPE_STATUS, CATEGORY) VALUES 
('一蘭拉麵', 0227583868, '臺北市信義區松仁路97號', '台北市', 121.56950886, 25.03662619, '貴而且普普', 1, '美食'),
('台北101', 0281018800, '臺北市信義區市府路45號', '台北市', 121.56400746, 25.03432525, '觀景台可以看整個北市的夜景', 1, '景點'),
('故宮博物院', 0228812021, '臺北市士林區至善路二段221號', '台北市', 121.54857787, 25.10305377, '國立故宮博物院是隸屬於中華民國行政院的中央二級機關', 1, '景點'),
('象山六巨石觀景台', '0227208889', '台北市信義區信義路五段150巷401弄31號', '台北市', 121.57443675, 25.02711050, '象山步道在台北市區內，交通方便，捷運站就在附近，延著階梯延路以欣賞風景的心情，或是以爬山運動的心情，都能讓你擁有視覺，聽覺空，嗅覺，心覺的感受', 1, '景點'),
('鼎泰豐 101店', 0281017799, '台北市信義區市府路45號B1', '台北市', 121.56517074, 25.03513199, '保守估計平均等候時間2～3小時,加上外國客人非常多,建議先拿號碼，去看場電影或是好好逛街', 1, '美食'),
('新村站著吃烤肉', 0227665258, '台北市信義區忠孝東路五段159號', '台北市', 121.56851549, 25.04145484, '肉質棒，醬汁也很搭，小菜好吃（蘿蔔、泡菜、黃金海帶芽），吃完不沾油煙味', 1, '美食'),
('饒河街觀光夜市', 0227668876, '台北市松山區饒河街', '台北市', 121.57723115, 25.05185621, '人潮洶湧，搭捷運或是火車都很方便，在車站旁，很適合旅客來走走', 1, '景點'),
('松山奉天宮', 0227279765, '台北市信義區福德街221巷12號', '台北市', 121.58502882, 25.03754779, '台北市最有名的天公廟，供奉玉皇大帝', 1, '景點'),
('臨江街觀光夜市', 0227134356, '台北市大安區臨江街', '台北市', 121.55443885, 25.03036476, '攤販很多 有糖葫蘆、水煮玉米、米其林推薦臭豆腐、生煎包、肉夾饃', 1, '景點'),
('松山文創園區', 0227651388, '台北市信義區光復南路133號', '台北市', 121.56061683, 25.04390461, '文青發揮靈感的好去處，停車可以在松山文創地下室停車非常方便，也可以選擇搭公車或是捷運過來', 1, '景點'),
('頂好紫琳蒸餃館', 0227520962, '台北市大安區忠孝東路四段97號B1樓', '台北市', 121.54790913, 25.04202658, '必點的是 蒸餃、鍋貼沒點就白來了，這次只有點鮮肉蒸餃下次會再來吃看看花素蒸餃', 1, '美食'),
('國立國父紀念館', 0227588008, '台北市信義區仁愛路四段505號', '台北市', 121.56026665, 25.04025414, '位置於台北市信義區，交通順暢，附近商家眾多，生活機能佳，環境嚴肅，停車方便，人潮川流，風景優美，歷史文化的活字典', 1, '景點'),
('阿薄郎薄皮餃子台式小酒館', 0287716686, '台北市大安區忠孝東路四段177號2樓之2', '台北市', 121.55061516, 25.04186918, '味道非常好!環境也很讚餃子屬於小顆,但是精緻美味所有品項都很好吃,值得一試', 1, '美食'),
('華山1914文化創意產業園區', 0223581914, '台北市中正區八德路一段1號', '台北市', 121.52944412, 25.04433222, '這間藏身舊酒廠的文化樞紐有不少商家進駐，還有當地藝術、電影、工藝展覽與活動', 1, '景點'),
('國立中正紀念堂', 0223431100, '台北市中正區中山南路21號', '台北市', 121.52018274, 25.03616187, '著名的紀念堂，周圍是一個大型公園，園內有魚塘和花園', 1, '景點'),
('新東南海鮮餐廳', 0223014239, '台北市中正區汀州路一段105號', '台北市', 121.51045241, 25.03594096, '這家絕對是老饕愛店，食材新鮮、美味', 1, '美食'),
('臺北植物園', 0223039978, '台北市中正區南海路53號', '台北市', 121.51005966, 25.03289983, '台北免門票景點，植物園區蠻大的，佔地8.2公頃，園區內植物高達2000多種', 1, '景點'),
('詹記麻辣火鍋', 0223777799, '台北市大安區和平東路三段60號', '台北市', 121.54918075, 25.02457236, '非常好吃的火鍋店！本人比較喜歡原味鍋底勝於麻辣的，原因是原味鍋底本身味道好鮮', 1, '美食'),
('國立臺灣科學教育館', 0266101234, '台北市士林區士商路189號', '台北市', 121.51653477, 25.09635731, '多樓層的科學博物館，其互動式展覽吸引不少家庭造訪，另設有餐廳和劇院', 1, '景點'),
('臺北市立兒童新樂園', 0228333823, '台北市士林區承德路五段55號', '台北市', 121.51495648, 25.09739623, '適合家庭出遊的景點，擁有兒童遊樂設施、室內外遊樂區和大型電玩', 1, '景點'),
('富樂臺式涮涮鍋', 0228866895, '台北市士林區承德路四段75-1號', '台北市', 121.52343130, 25.08215485, '劍潭這邊的老字號火鍋名店，儘管現在出了許多更新穎更亮麗的火鍋店，又在距離士林夜市不遠的地方，但仍然是屹立不搖', 0, '美食'),
('有之和牛', 0287851117, '台北市信義區忠孝東路五段497號1樓', '台北市', 121.57812367, 25.04276954, '肉質相當不錯，美國赤牛見島黑牛與熟成肋眼牛相當鮮美，擺盤賞心悅目', 1, '美食'),
('M One Cafe', 0227220150, '台北市信義區松壽路11號3樓', '台北市', 121.56730899, 25.03934512, '薯絲是必點的，外層酥脆，內層鬆軟，第一次知道馬鈴薯的好吃，麵包類也都表現的很好，又鬆軟又有嚼勁', 1, '美食');

-- 營業時間 --
CREATE TABLE OPENTIME (
	OPENTIME_ID INT AUTO_INCREMENT NOT NULL,
	FOODSCAPE_ID INT NOT NULL,
	START_TIME TIME NOT NULL,
	END_TIME   TIME NOT NULL,
	OPENTIME_WEEK CHAR(1) NOT NULL,
    
    PRIMARY KEY (OPENTIME_ID),
	FOREIGN KEY (FOODSCAPE_ID) REFERENCES FOODSCAPE (FOODSCAPE_ID)
) AUTO_INCREMENT = 1;

INSERT INTO OPENTIME(FOODSCAPE_ID, START_TIME, END_TIME, OPENTIME_WEEK) VALUES (22001, '8:00', '11:00', 3), (22001, '15:00', '20:00', 3), (22002, '12:00', '21:00', 4);

-- 美食/景點圖片 (關係) --
CREATE TABLE FOODSCAPE_IMG(
	IMG_ID INT AUTO_INCREMENT NOT NULL,
	FOODSCAPE_ID INT NOT NULL,
	CREATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP,
	BLOG_IMG LONGBLOB,
    
    PRIMARY KEY (IMG_ID),
	FOREIGN KEY (FOODSCAPE_ID) REFERENCES FOODSCAPE (FOODSCAPE_ID)
) AUTO_INCREMENT = 1;

INSERT INTO FOODSCAPE_IMG(FOODSCAPE_ID) VALUES (22001), (22002), (22002);

-- 標籤 --
CREATE TABLE TAG (
	TAG_ID INT AUTO_INCREMENT NOT NULL,
	TAG_NAME VARCHAR(20) NOT NULL,
	UPDATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
	PRIMARY KEY (TAG_ID)
) AUTO_INCREMENT = 21001;

INSERT INTO TAG (TAG_NAME) VALUES ('台北'), ('日式');

-- 美食/景點標籤(關係) --
CREATE TABLE FOODSCAPE_TAG(
	TAG_ID INT NOT NULL,
	FOODSCAPE_ID INT NOT NULL,
    
	PRIMARY KEY (TAG_ID, FOODSCAPE_ID),
	FOREIGN KEY (TAG_ID) REFERENCES TAG (TAG_ID),
	FOREIGN KEY (FOODSCAPE_ID) REFERENCES FOODSCAPE (FOODSCAPE_ID)
);

INSERT INTO FOODSCAPE_TAG(TAG_ID, FOODSCAPE_ID) VALUES (21001, 22001), (21001, 22002), (21002, 22001);

-- 行程 --
CREATE TABLE JOURNEY (
	JOURNEY_ID      INT NOT NULL AUTO_INCREMENT,
	JOURNEY_NAME    VARCHAR(50) NOT NULL,
	PRICE           INT NOT NULL,    
	CREATE_TIME     DATETIME DEFAULT CURRENT_TIMESTAMP,
	CONTENT         LONGTEXT,
	AVG_SCORE       DOUBLE(2, 1) NOT NULL DEFAULT 0,
	SCORE_COUNT     INT NOT NULL DEFAULT 0,    
	DAYS            INT NOT NULL,    
	BUY_COUNT       INT NOT NULL DEFAULT 0,    
	JOURNEY_STATUS  CHAR(1) NOT NULL,

	CONSTRAINT JOURNEY_PK PRIMARY KEY (JOURNEY_ID)
) AUTO_INCREMENT = 23001;

INSERT INTO JOURNEY (JOURNEY_NAME, PRICE, CONTENT, AVG_SCORE, SCORE_COUNT, DAYS, BUY_COUNT, JOURNEY_STATUS) VALUES 
('市區二日遊', 2000, '走走吃吃', 0, 0, 2, 0, 0),
('台北三天兩夜美食旅', 15000, '爽吃', 4.1, 6, 3, 10, 1),
('療育悠閒四日遊', 25000, '慢活行程', 4.7, 8, 4, 22, 1),
('市區二日遊2', 3000, '走走吃吃2', 3, 44, 2, 55, 1);


-- 行程-時間地點 (關係) -- 
CREATE TABLE JOURNEY_DETAIL (
	JOURNEY_ID      INT NOT NULL,
	FOODSCAPE_ID    INT NOT NULL,
	START_TIME      TIME NOT NULL,
	END_TIME        TIME NOT NULL,
	NTH_DAY         INT NOT NULL,

	CONSTRAINT JOURNEY_DETAIL_PK PRIMARY KEY (JOURNEY_ID, FOODSCAPE_ID),
	CONSTRAINT JOURNEY_DETAIL_FK1 FOREIGN KEY (JOURNEY_ID) REFERENCES JOURNEY (JOURNEY_ID),
	CONSTRAINT JOURNEY_DETAIL_FK2 FOREIGN KEY (FOODSCAPE_ID) REFERENCES FOODSCAPE (FOODSCAPE_ID)
);

INSERT INTO JOURNEY_DETAIL (JOURNEY_ID, FOODSCAPE_ID, START_TIME, END_TIME, NTH_DAY) VALUES 
(23001, 22001, '10:00:00', '12:00:00', 1),
(23001, 22004, '13:00:00', '16:00:00', 1),
(23001, 22008, '16:30:00', '17:00:00', 1),
(23001, 22011, '06:00:00', '08:00:00', 2),
(23001, 22012, '09:00:00', '11:00:00', 2),
(23001, 22015, '14:00:00', '16:00:00', 2),
(23001, 22013, '17:00:00', '18:00:00', 2),
(23002, 22001, '10:00:00', '12:00:00', 1),
(23002, 22005, '16:00:00', '18:00:00', 1),
(23003, 22012, '09:00:00', '11:00:00', 1),
(23003, 22020, '14:00:00', '16:00:00', 1),
(23003, 22021, '17:00:00', '18:00:00', 3),
(23003, 22019, '10:00:00', '12:00:00', 2),
(23003, 22005, '16:00:00', '18:00:00', 2),
(23003, 22004, '14:00:00', '16:00:00', 2),
(23003, 22003, '18:00:00', '21:00:00', 4),
(23003, 22022, '10:00:00', '12:00:00', 4),
(23003, 22023, '14:00:00', '16:00:00', 4),
(23003, 22010, '22:00:00', '23:00:00', 4),
(23002, 22003, '14:00:00', '16:00:00', 1),
(23002, 22004, '18:00:00', '21:00:00', 3),
(23002, 22008, '10:00:00', '12:00:00', 2),
(23002, 22006, '13:00:00', '15:00:00', 2),
(23002, 22007, '15:00:00', '17:00:00', 3),
(23002, 22002, '12:00:00', '14:00:00', 1),
(23002, 22022, '18:00:00', '21:00:00', 2),
(23002, 22015, '12:00:00', '14:00:00', 3),
(23004, 22001, '10:00:00', '12:00:00', 1),
(23004, 22004, '13:00:00', '16:00:00', 1),
(23004, 22008, '16:30:00', '17:00:00', 1),
(23004, 22011, '06:00:00', '08:00:00', 2),
(23004, 22012, '09:00:00', '11:00:00', 2),
(23004, 22015, '14:00:00', '16:00:00', 2),
(23004, 22013, '17:00:00', '18:00:00', 2);


-- 旅行團 --
CREATE TABLE TOUR_GROUP (
	GROUP_ID          INT NOT NULL AUTO_INCREMENT,
	JOURNEY_ID        INT NOT NULL,
	START_TIME        DATE NOT NULL,
	END_TIME          DATE NOT NULL,
	PRICE             INT NOT NULL,
	SIGNUP_NUM        INT NOT NULL,
	MIN_REQUIRED      INT NOT NULL,
	MAX_REQUIRED      INT NOT NULL,
	SIGNUP_DATE       DATETIME NOT NULL,
	DUE_DATE          DATETIME NOT NULL,
	CREATE_TIME       DATETIME DEFAULT CURRENT_TIMESTAMP,
	UPDATE_TIME       DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    GROUP_STATUS      CHAR(1) NOT NULL,

	CONSTRAINT TOUR_GROUP_PK PRIMARY KEY (GROUP_ID),
	CONSTRAINT TOUR_GROUP_FK FOREIGN KEY (JOURNEY_ID) REFERENCES JOURNEY (JOURNEY_ID)
) AUTO_INCREMENT = 24001;

INSERT INTO TOUR_GROUP (JOURNEY_ID, START_TIME, END_TIME, PRICE, SIGNUP_NUM, MIN_REQUIRED, MAX_REQUIRED, SIGNUP_DATE, DUE_DATE, GROUP_STATUS) VALUES 
(23001, '2024-09-28', '2024-09-29', 2000, 20, 15, 30, '2023-09-08 10:00:00', '2024-01-20 20:00:00', 1),
(23001, '2024-09-28', '2024-09-29', 3000, 20, 15, 30, '2023-09-08 10:00:00', '2024-01-20 20:00:00', 1),
(23002, '2024-09-30', '2024-10-02', 15000, 30, 13, 100, '2023-09-01 10:00:00', '2024-01-20 23:00:00', 1),
(23002, '2024-10-01', '2024-10-02', 10000, 10, 20, 40, '2023-09-11 10:00:00', '2024-01-30 23:00:00', 1),
(23002, '2024-09-29', '2024-10-02', 15000, 35, 25, 150, '2023-09-01 12:00:00', '2024-01-20 22:00:00', 1),
(23003, '2024-10-28', '2024-10-29', 1111, 0, 33, 33, '2023-09-08 10:00:00', '2024-01-20 20:00:00', 1),
(23003, '2024-10-30', '2024-11-02', 15225, 22, 44, 104, '2023-09-01 10:00:00', '2024-01-20 23:00:00', 1),
(23003, '2024-10-01', '2024-11-02', 6666, 1, 55, 45, '2023-09-11 10:00:00', '2024-01-30 23:00:00', 1),
(23004, '2024-10-30', '2024-11-02', 10001, 0, 99, 199, '2023-12-28 20:50:00', '2024-01-20 23:00:00', 0),
(23004, '2024-10-30', '2024-11-02', 20002, 22, 88, 188, '2023-09-01 10:00:00', '2023-12-28 20:50:00', 1);


-- 優惠券 --
CREATE TABLE COUPON (
	COUPON_ID INT NOT NULL AUTO_INCREMENT,
    SERIAL_NO VARCHAR(20) NOT NULL,
    COUPON_NAME VARCHAR(20) NOT NULL,
    DISCOUNT INT NOT NULL,
    THRESHOLD INT NOT NULL,
    START_TIME DATETIME NOT NULL,
    END_TIME DATETIME NOT NULL,
    STOCK INT NOT NULL,
    TOTAL INT NOT NULL,
    COUPON_STATUS CHAR NOT NULL DEFAULT '1',
    
    CONSTRAINT COUPON_PRIMARY_KEY PRIMARY KEY (COUPON_ID),
    CONSTRAINT COUPON_UNIQUE_KEY UNIQUE KEY (SERIAL_NO)
) AUTO_INCREMENT = 32001;

INSERT INTO COUPON (SERIAL_NO, COUPON_NAME, DISCOUNT, THRESHOLD, START_TIME, END_TIME, STOCK, TOTAL) VALUES ("54188","父親節優惠" , 888, 2000, "2023-08-01 00:00:00", "2023-08-09 00:00:00", 88888, 88888);
INSERT INTO COUPON (SERIAL_NO, COUPON_NAME, DISCOUNT, THRESHOLD, START_TIME, END_TIME, STOCK, TOTAL) VALUES ("1111","雙十一優惠" , 1111, 2000, "2023-11-01 00:00:00", "2023-11-12 00:00:00", 1111, 1111);
INSERT INTO COUPON (SERIAL_NO, COUPON_NAME, DISCOUNT, THRESHOLD, START_TIME, END_TIME, STOCK, TOTAL) VALUES ("2222","二月優惠" , 222, 2000, "2023-02-01 00:00:00", "2023-2-28 00:00:00", 0, 200);
INSERT INTO COUPON (SERIAL_NO, COUPON_NAME, DISCOUNT, THRESHOLD, START_TIME, END_TIME, STOCK, TOTAL) VALUES ("3333","三月優惠" , 333, 3000, "2023-03-01 00:00:00", "2023-3-31 00:00:00", 1, 300);
INSERT INTO COUPON (SERIAL_NO, COUPON_NAME, DISCOUNT, THRESHOLD, START_TIME, END_TIME, STOCK, TOTAL) VALUES ("4444","四月優惠" , 444, 4000, "2023-04-01 00:00:00", "2023-4-30 00:00:00", 2, 200);
-- 會員_優惠券 --
CREATE TABLE CUSTOMER_COUPON(
	CUSTOMER_ID INT NOT NULL,
    COUPON_ID INT NOT NULL,
    COUPON_STATUS CHAR(1) NOT NULL DEFAULT '0',
    CREATE_TIME DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UPDATE_TIME DATETIME ON UPDATE CURRENT_TIMESTAMP,
    
    CONSTRAINT COSTOMER_COUPON_PRIMARY_KEY PRIMARY KEY (CUSTOMER_ID, COUPON_ID),
	CONSTRAINT COSTOMER_COUPON_FOREIGN_KEY1 FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID),
    CONSTRAINT COSTOMER_COUPON_FOREIGN_KEY2 FOREIGN KEY (COUPON_ID) REFERENCES COUPON(COUPON_ID)
);

INSERT INTO CUSTOMER_COUPON (CUSTOMER_ID, COUPON_ID) VALUES (11001, 32001);
INSERT INTO CUSTOMER_COUPON (CUSTOMER_ID, COUPON_ID) VALUES (11002, 32001);
INSERT INTO CUSTOMER_COUPON (CUSTOMER_ID, COUPON_ID) VALUES (11002, 32002);

-- 訂單 --
CREATE TABLE ORDERS(
	ORDER_ID INT AUTO_INCREMENT NOT NULL,
    CUSTOMER_ID INT NOT NULL,
    GROUP_ID INT NOT NULL,
    CREATE_TIME DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    UPDATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PAID_TIME DATETIME,
    TOTAL_AMT INT NOT NULL,
    ORDER_STATUS  CHAR(1) NOT NULL,
    CUSTOMER_POINT INT NOT NULL,
    COUPON_ID INT,
    TOURIST INT,
    CONTENT LONGTEXT,
    CONTENT_TIME DATETIME,
    SCORE DOUBLE,
    ORDER_NO varchar(30),

    CONSTRAINT ORDERS_PRIMARY_KEY PRIMARY KEY (ORDER_ID),
	CONSTRAINT ORDERS_FOREIGN_KEY1 FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID),
	CONSTRAINT ORDERS_FOREIGN_KEY2 FOREIGN KEY(GROUP_ID) REFERENCES TOUR_GROUP(GROUP_ID),
	CONSTRAINT ORDERS_FOREIGN_KEY3 FOREIGN KEY(COUPON_ID) REFERENCES COUPON(COUPON_ID) 
) AUTO_INCREMENT = 31001;

INSERT INTO ORDERS (CUSTOMER_ID, GROUP_ID, TOTAL_AMT, ORDER_STATUS, CUSTOMER_POINT, COUPON_ID, TOURIST, ORDER_NO) VALUES (11001, 24001, 3000, 0, 0, 32001, 1, 2024110801);
INSERT INTO ORDERS (CUSTOMER_ID, GROUP_ID, TOTAL_AMT, ORDER_STATUS, CUSTOMER_POINT, COUPON_ID, TOURIST, ORDER_NO) VALUES (11002, 24002, 6000, 1, 50, 32002, 4, 2024110802);


-- 旅客明細 --
CREATE TABLE PASSENGER(
	PASSENGER_ID INT NOT NULL AUTO_INCREMENT,
    ORDER_ID INT NOT NULL,
    IDNO CHAR(10) NOT NULL,
    PASSENGER_NAME VARCHAR(20) NOT NULL,
    PHONE CHAR(10) NOT NULL,
    BIRTH DATE NOT NULL,
    
    CONSTRAINT PASSENGER_PRIMARY_KEY PRIMARY KEY (PASSENGER_ID),
    CONSTRAINT PASSENGER_FOREIGN_KEY FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID)
) AUTO_INCREMENT = 1;

INSERT INTO PASSENGER (ORDER_ID, IDNO, PASSENGER_NAME, PHONE, BIRTH) VALUES (31001, "A123456789","王小民", "0912345678", "1911-01-01");
INSERT INTO PASSENGER (ORDER_ID, IDNO, PASSENGER_NAME, PHONE, BIRTH) VALUES (31001, "A334433356","王二民", "0933542448", "1911-02-02");
INSERT INTO PASSENGER (ORDER_ID, IDNO, PASSENGER_NAME, PHONE, BIRTH) VALUES (31002, "A334433356","王二民", "0933542448", "1911-02-02");

-- 部落格文章 --
CREATE TABLE BLOG (
	BLOG_ID	INT AUTO_INCREMENT NOT NULL,
	TITLE VARCHAR(50) NOT NULL,
	CUSTOMER_ID INT NOT NULL,
    BLOG_DATE DATETIME NOT NULL,
    CONTENT LONGTEXT,
    UPDATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    CREATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP,
    LIKE_SUM INT,
    VIEW_SUM INT,
    CL_SUM INT,
    IMG LONGBLOB,
    BLOG_STATUS CHAR NOT NULL DEFAULT '1',
    
    PRIMARY KEY (BLOG_ID),
    FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER (CUSTOMER_ID)
) AUTO_INCREMENT = 41001;

INSERT INTO BLOG (TITLE, CUSTOMER_ID, BLOG_DATE, CONTENT) VALUES ('中山區拉麵推薦', 11001, '2023-10-09', 'abc');
INSERT INTO BLOG (TITLE, CUSTOMER_ID, BLOG_DATE, CONTENT) VALUES ('台南必吃牛肉湯', 11002, '2023-08-12', 'xxx');

-- 美食/景點 對 部落格文章 (關係) --
CREATE TABLE FOODSCAPE_BLOG(
	FOODSCAPE_ID INT NOT NULL,
	BLOG_ID INT NOT NULL,
    
	PRIMARY KEY (FOODSCAPE_ID, BLOG_ID),
	FOREIGN KEY (FOODSCAPE_ID) REFERENCES FOODSCAPE (FOODSCAPE_ID),
	FOREIGN KEY (BLOG_ID) REFERENCES BLOG (BLOG_ID)
);

INSERT INTO FOODSCAPE_BLOG(FOODSCAPE_ID, BLOG_ID) VALUES (22001, 41001), (22002, 41001), (22002, 41002);

-- 文章留言 --
CREATE TABLE BLOG_MSG(
	BLOG_MSG_ID   INT AUTO_INCREMENT NOT NULL,
	CONTENT   LONGTEXT,
	BLOG_ID   INT NOT NULL,
	CUSTOMER_ID  INT NOT NULL,
	CREATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    PRIMARY KEY (BLOG_MSG_ID),
    FOREIGN KEY (BLOG_ID) REFERENCES BLOG (BLOG_ID),
 	FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER (CUSTOMER_ID)
) AUTO_INCREMENT = 1;

INSERT INTO BLOG_MSG (CONTENT, BLOG_ID, CUSTOMER_ID) VALUES ('hi', 41001, 11002);
INSERT INTO BLOG_MSG (CONTENT, BLOG_ID, CUSTOMER_ID) VALUES ('hello', 41001, 11002);

-- 內文圖片 --
CREATE TABLE BLOG_IMG(
	BLOG_IMG_ID   INT AUTO_INCREMENT NOT NULL,
	BLOG_ID   INT NOT NULL,
	CREATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP,
	IMG  LONGBLOB,
    
    PRIMARY KEY (BLOG_IMG_ID),
	FOREIGN KEY (BLOG_ID) REFERENCES BLOG (BLOG_ID)
) AUTO_INCREMENT = 1;

INSERT INTO BLOG_IMG (BLOG_ID) VALUES (41001);
INSERT INTO BLOG_IMG (BLOG_ID) VALUES (41002);
INSERT INTO BLOG_IMG (BLOG_ID) VALUES (41002);

-- 文章按讚 --
CREATE TABLE BLOG_LIKE(
	BLOG_LIKE_ID  INT AUTO_INCREMENT NOT NULL,
	CUSTOMER_ID   INT NOT NULL,
	CREATE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	BLOG_ID  INT NOT NULL,
    BLOG_LIKE_STATUS CHAR(1) NOT NULL DEFAULT '1',
    
    PRIMARY KEY (BLOG_LIKE_ID),
	FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER (CUSTOMER_ID),
	FOREIGN KEY (BLOG_ID) REFERENCES BLOG (BLOG_ID)
) AUTO_INCREMENT = 1;

INSERT INTO BLOG_LIKE (CUSTOMER_ID, BLOG_ID) VALUES (11001, 41001);
INSERT INTO BLOG_LIKE (CUSTOMER_ID, BLOG_ID) VALUES (11002, 41001);
INSERT INTO BLOG_LIKE (CUSTOMER_ID, BLOG_ID) VALUES (11002, 41002);

-- 文章收藏 --
CREATE TABLE BLOG_CL(
	BLOG_CL_ID INT AUTO_INCREMENT NOT NULL,
	CUSTOMER_ID INT NOT NULL,
	LIKE_TIME DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	BLOG_ID INT NOT NULL,
    BLOG_CL_STATUS CHAR(1) NOT NULL DEFAULT '1',
    
    PRIMARY KEY (BLOG_CL_ID),
	FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID),
	FOREIGN KEY (BLOG_ID) REFERENCES BLOG (BLOG_ID)
) AUTO_INCREMENT = 42001;

INSERT INTO BLOG_CL(CUSTOMER_ID, BLOG_ID) VALUES (11001, 41001);
INSERT INTO BLOG_CL(CUSTOMER_ID, BLOG_ID) VALUES (11002, 41001);
INSERT INTO BLOG_CL(CUSTOMER_ID, BLOG_ID) VALUES (11002, 41002);

-- 文章對標籤 --
CREATE TABLE BLOG_TAG(
	BLOG_ID  INT NOT NULL,
	TAG_ID   INT NOT NULL,
    
    PRIMARY KEY (BLOG_ID, TAG_ID),
	FOREIGN KEY (BLOG_ID) REFERENCES BLOG (BLOG_ID),
	FOREIGN KEY (TAG_ID) REFERENCES TAG (TAG_ID)
);

INSERT INTO BLOG_TAG VALUES (1, 1);
INSERT INTO BLOG_TAG VALUES (2, 1);
INSERT INTO BLOG_TAG VALUES (2, 2);


SET FOREIGN_KEY_CHECKS=1;
